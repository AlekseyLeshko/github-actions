name: Master branch

on:
  push:
    branches:
      - master
    tags-ignore:
      - '*'
      - '**'

jobs:
  bump_version:
    strategy:
      matrix:
        node-version: [10.10.0]
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
      with:
        ref: master

    - name: Bump version
      run: |
        echo $GITHUB_ACTOR
        git branch
        git checkout --track origin/master
        git branch
        export CURRENT_HASH=$(echo $(git rev-parse --short HEAD))
        echo $CURRENT_HASH
        export COMMIT_MESSAGE="$(echo $(git log -n 1 --pretty=format:%B))"
        echo $COMMIT_MESSAGE
        export VERSION_TYPE="patch"
        export TAG=$(echo $(git tag --contains $CURRENT_HASH))
        echo $TAG
        # export VERSION_TYPE=$(node pipelines/get-version-type.js "$COMMIT_MESSAGE")
        if [ ! -z "$TAG" ] ; then exit 0; fi
        echo $VERSION_TYPE
        git --version
        git status
        git config --global push.default simple
        git config --global user.email "github@example.com"
        # git config --global user.name ${ GITHUB_ACTOR }
        npm version $VERSION_TYPE -m "v%s"
        git status

    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
